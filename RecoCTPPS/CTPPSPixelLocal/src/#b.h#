int RPixDetClusterizer::calibrate(unsigned int detId, int adc, int row, int col)
{

  float gain=0;
  float pedestal=0;
  float electrons=0;


//detId = 2014314496; //just one plane in test DB file 

  if(!doSingleCalibration_){
    theDAQcalibration->getDAQCalibration(detId,row,col,gain,pedestal);

    float vcal = (adc - pedestal)*gain*1800./260.;
    electrons = int(vcal*VcaltoElectronGain_ + VcaltoElectronOffset_);
//    std::cout << " FFF   gain "<<  gain <<"  pedestal "<< pedestal 
//<< "  adc "<< adc  << "  vcal " << vcal << "  electrons "<<electrons << std::endl;

    if(verbosity_) edm::LogInfo("RPixCalibration") << "calibrate:  adc = " << adc << " electrons = " << electrons << " gain = " << gain << " pedestal = " << pedestal ;
  }else{
    gain = ElectronADCGain_;
    pedestal = 0;
    electrons = int(adc*gain-pedestal);
    if(verbosity_) edm::LogInfo("RPixCalibration") << "calibrate:  adc = " << adc << " electrons = " << electrons << " ElectronADCGain = " << gain << " pedestal = " << pedestal ;
  }
  if (electrons<0) {
    edm::LogInfo("RPixCalibration") << "RPixDetClusterizer::calibrate: *** electrons < 0 *** --> " << electrons << "  --> electrons = 0";
    electrons = 0;
  }

  return electrons;

}